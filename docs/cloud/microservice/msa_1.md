---
layout: default
title: Microservice 이해하기
parent: Microservice
grand_parent: Cloud
nav_order: 1
---

# **Microservice 이해하기**

{: .bg-purple-000}

---

## 마이크로서비스 특징

1. 빠르게 개발해 지속적으로 배포\
   작고 경량화되어 있음.
2. 수동 혹은 자동으로 쉽게 스케일링\
   스케일아웃, 오토스케일링 등 확장성이 좋다.
3. 마이크로서비스는 데이터베이스와 데이터를 공유하지 않음\
   stateless, 즉 상태를 유지하지 않고 데이터를 따로 저장하지 않는다.\
   필요한 데이터는 DB같은 저장소에서 가져오지만 가져온 데이터를 가지고 있거나 공유하지 않는다.
4. 명확한 인터페이스를 통해서만 통신
5. 개별적인 런타임 프로세스로 배포
6. 마이크로 서비스 인스턴스는 상태가 없음.
7. 개발자가 작성할 수 있을만한 크기로 구현
8. 성능(대기 시간)이나 데이터 일관성을 저해하지 않을 정도의 규모

{: .bg-purple-000}

---

## 마이크로서비스 적용시 문제점

1. 동기식 통신을 사용하는 다수의 소형 컴포넌트는 연쇄 장애를 일으킬 수 있음.
2. 다수의 소형 컴포넌트를 최신 상태로 유지하는 것이 어려움.
3. 많은 컴포넌트 처리에 관여하는 요청은 추적하기 어려움.
4. 컴포넌트 수준의 하드웨어 자원 사용량 분석도 어려움.
5. 다수의 소형 컴포넌트를 수동으로 구성하고 관리할 때 비용이 많이 들고 오류가 발생하기 쉬움.

{: .bg-purple-000}

---

## Microservice 디자인 패턴

1. **서비스 디스커버리**\
   - 마이크로 서비스를 자동으로 등록 및 해지
   - 요청을 마이크로서비스 엔드포인트에 보내면 여러개 중 1개로 라우팅
   - 만약 마이크로서비스를 백엔드에 추가하고자 하는 경우, 이 서비스의 IP나 도메인명과 같은 엔드포인트를 자동적으로 앞단의 프론트엔드 봇, 로드밸런스, 리버스 프록시 서버에 자동으로 등록해서 라우팅 및 로드밸런싱을 할 수 있도록 적용가능하다.
2. **Edge 서버**
   - 외부 마이크로서비스로만 연결, 내부 서비스는 외부에 공개되지 않음.
   - 하나하나씩 외부랑 연결되는 형태는 좋지 않다. 보안에 취약하고 이슈 발생 시 외부와의 통신에 있어 추적이 어려움.
   - 외부로 공개시 표준 프로토콜 및 OAuth, API Key 등 보안 적용 후 연결(인증받은 클라이언트만 연결할 수 있도록 적용해야 함.
3. **Reactive 마이크로 서비스**
   - 비동기 형태로 메시지를 처리
   - 동기식 형태로 처리가 요구되면 논블로킹 I/O를 사용
4. **Config 중앙화**
   - 마이크로서비스의 설정 정보를 중앙 서버에 저장/관리
   - 한 번에 적용되는 설정이 있을 수 있고 서비스마다 적용되는 경우가 있는데 공통된 부분은 중앙 서버에서 관리
5. **Logging 중앙화**
   - 로그를 마이크로서비스마다 걸게 되면 로그를 한번에 모아서 수집해서 처리할 수 있도록 중앙 서버에서 관리하도록 함.
   - 로그 이벤트를 조회 및 분석하기 위한 API 및 GUI 제공
6. **Distributed Tracing**
   - 모든 요청 및 메시지 고유의 ID가 있고, 로그 이벤트에도 ID 적용. 특정 트랜잭션에서 이슈가 발생했을 때 쉽게 찾을 수 있고 인덱싱을 통해 쉽게 추적 가능하다.
   - 사전에 정의된 ID가 적용되고 로그 이벤트에서 ID로 검색 및 분산 추적
7. **Circuit Breaker**
   - 대상 서비스 문제를 감지하면, 새로운 요청을 보내지 않도록 차단
   - Circuit을 Open 후 장애 확산을 방지하고, 조치가 완료되면 Close로 원복
8. **Control loop**
   - 원하는 상태(Desired state)와 현재 상태(Current state)를 비교, 관찰
   - 두 상태가 다른 경우에는 GitOps 기반으로 상태를 일치하도록 Sync 수행
9. **Monitoring & Alarm 중앙화**
   - 자원 사용량의 메트릭 수집 및 새로운 서비스에 대한 메트릭 자동 등록
   - 수집한 메트릭을 조회 및 분석하기 위한 API와 GUI 제공

{: .bg-purple-000}

---

## Microservice 디자인 패턴 관련 오픈소수 도구 목록

| 디자인 패턴               | Spring             | Kubernetes             | Istio             |
| :------------------------ | :----------------- | :--------------------- | :---------------- |
| 서비스 디스커버리         | Eureka 및 Ribbon   | CoreDNS 및 Service     |                   |
| Edge 서버                 | Zuul               | Ingress                | Ingress Gateway   |
| Reactive 마이크로 서비스  | Reactor 및 WebFlux |                        |                   |
| Config 중앙화             | Config Server      | Configmap 및 Secret    |                   |
| Logging 중앙화            |                    | Elasticsearch, Fluentd |                   |
| Distributed Tracing       | Sleuth 및 Zipkin   |                        | Jaeger            |
| Circuit Breaker           | Resilience4j       |                        | Outlier detection |
| Control loop              |                    | Controller manager     |                   |
| Monitoring & Alarm 중앙화 |                    | Prometheus, Grafana    | Kiali             |
