---
layout: default
title: 로드 밸런서 기본
parent: Network
grand_parent: Computer Science
nav_order: 4
---

# **로드 밸런서 기본**

{: .bg-purple-000}

---

{: .important}

많은 트래픽 => 부하 분산 => 서버 비용 절감 => 돈 절약 => 기업의 목표 => 개발자 역할

서버나 장비의 부하를 분산하기 위해 사용하는 장비를 흔히 **로드 밸런서**라고 부른다.\
트래픽을 분배해주는 기능 떄문인데 4계층 이상에서 동작하면서 IP 주소나 4계층 정보, 앱 정보 확인 및 수정하는 기능이 있다.

가장 많이 쓰이는 분야는 웹 서버의 부하 분산이다.\
사용자 천 명의 요청을 동시에 처리해주는 서버보다 사용자 5천명의 요청을 동시에 처리해주는 서버의 가격은 5배가 아니라 이보다 훨씬 비싸다.

내부 부품을 이중화하거나 용량이 더 큰 부품을 사용하면 가격이 크게 올라가므로 작은 장비 여러 대를 묶어 사용하는 방법을 선호한다.\
이를 **스케일 아웃**이라고 한다.

{: .bg-purple-000}

---

## 로드 밸런서

작은 시스템 여러 대를 운영하더라도 사용자는 서버 배치와 상관없이 하나의 서비스로 보여야 한다.\
로드 밸런서가 서비스에 사용되는 대표 IP 주소를 서비스 IP로 갖고 그 밑에 시스템이 늘어나면 로드 밸런서가 각 시스템의 실제 IP로 변경해 요청을 보낸다.

로드 밸런서는 동작하는 계층에 따라 보통 4계층과 7계층으로 나뉜다.

- <span style="background-color:yellow;  font-weight:700">L4 로드 밸런싱</span>\
  일반적인 로드 밸런서가 동작하는 방식이다.\
  TCP, UDP 정보를 기반으로 로드 밸런싱을 수행한다.\
  최근 로드 밸런서는 L4, L7의 기능을 모두 지원하므로 L4 로드 밸런싱만 제공하는 전용장비는 찾기 힘들지만 L7 지원 여부와 상관없이 4계층에 대한 정보로만 분산 처리하는 경우를 L4 로드 밸런싱이라고 한다.
- <span style="background-color:yellow;  font-weight:700">L7 로드 밸런싱</span>\
  HTTP, FTP, SMTP와 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱을 수행한다.\
  HTTP 헤더 정보나 URI와 같은 정보를 기반으로 프로토콜을 분해한 후 부하를 분산할 수 있다.\
  일반적으로 이런 장비를 ADC(Application Delivery Controller)라고 부르며 **프록시(Proxy)** 역할을 수행한다.\
  스퀴드(Squid)나 Nginx에서 수행하는 리버스 프록시와 유사한 기능을 갖고 있다.

{: .note}
데이터 센터에서 사용하는 로드 밸런서 장비는 L4, L7을 모두 지원하며 실제로 어떻게 설정했는가에 따라 L4와 L7으로 나뉜다.\
반면, 클라우드에서는 L4와 L7을 지원하는 컴포넌트를 계층별로 구분해 전용으로 사용한다.\
예로 AWS의 **NLB(Network Load Balancer)**가 L4 로드 밸런싱, **ALB(Application Load Balancer)**가 L7 로드 밸런싱용 전용 컴포넌트이다.

{: .bg-purple-000}

---

## L4 스위치

L4 스위치는 용어 그대로 4계층에서 동작하면서 로드 밸런서 기능이 있는 스위치이다.

내부 동작 방식은 4계층 로드 밸런서이지만 외형은 스위치처럼 여러 개의 포트를 가지고 있다.\
서버형 로드 밸런서나 소프트웨어 형태의 로드 밸런서도 있지만 다양한 네트워크 구성이 가능한 스위치형 로드 밸런서가 가장 대중화되어 있다.\
L4 스위치는 부하 분산, 성능 최적화, 리다이렉션 기능을 제공한다.

L4 스위치가 동작하려면 <span style="color:red; font-weight:700">가상 서버, 가상 IP, 리얼 서버, 리얼 IP</span>을 설정해야 한다.\
가상 서버는 사용자가 바라보는 실제 서비스이고 가상 IP는 사용자가 접근해야 하는 IP 주소이다.\
리얼 서버는 실제 서비스를 수행하는 서버이고 리얼 IP는 실제 서버의 IP이다.\
여기서 L4 스위치는 가상 IP를 리얼 IP로 변경해주는 역할을 한다.

사용자는 L4 스위치의 가상 IP를 목적지로 서비스를 요청하고 L4 스위치가 목적지로 설정된 가상 IP를 리얼 IP로 다시 변경해 보내준다.\
이 과정에서 부하를 어떤 방식으로 분산할지 결정할 수 있다.

## ADC(Application Delivery Controller)

ADC는 애플리케이션 계층에서 동작하는 로드 밸런서이다.

L4 스위치와 달리 애플리케이션 프로토콜의 헤더와 내용을 이해하고 동작하므로 다양한 부하 분산, 정보 수정, 정보 필터링이 가능하다.\
ADC는 이런 상세한 동작을 위해 프록시로 동작한다.

대부분의 ADC는 4계층에서 애플리케이션 계층까지 로드 밸런싱 기능을 제공하고 페일오버(장애극복 기능), 리다이렉션 기능도 함께 수행한다.\
이 외에도 애플리케이션 프로토콜을 이해하고 최적화하는 다양한 기능을 제공한다.\
캐싱, 압축, 콘텐츠 변환 및 재작성, 인코딩 변환 등이 가능하고 애플리케이션 프로토콜 최적화 기능도 제공한다.
